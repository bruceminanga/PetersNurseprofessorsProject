{% extends 'base.html' %}
{% load static %}
{% block content %}

<br><br><br><br><br>
    <div class="container mt-4">
        <h2 class="mb-4">Unpaid Orders</h2>
        <table class="table table-bordered">
            <thead>
                <tr>
                    <th>Order ID</th>
                    <th>Title</th>
                    <th>Type of Paper</th>
                    <th>Words</th>
                    <th>Price</th>
                    <th>Order Date</th>
                    <th>Deadline</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                {% for order in unpaid_orders %}
                <tr id="order-{{ order.id }}">
                    <td><a href="#">{{ order.id }}</a></td>
                    <td>{{ order.title }}</td>
                    <td>{{ order.type_of_paper }}</td>
                    <td>{{ order.words }}</td>
                    <td>${{ order.price }}</td>
                    <td>{{ order.date|date:"Y-m-d" }}</td>
                    <td>{{ order.deadline }}</td>
                    <td>
                        <button class="btn btn-success">Pay Now</button>
                        <button class="btn btn-danger" onclick="cancelOrder({{ order.id }})">Cancel Order</button>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    <br><br><br>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
<script>
function cancelOrder(orderId) {
    if (confirm("Are you sure you want to cancel this order?")) {
        $.ajax({
            url: '{% url "app1:cancel_order" 0 %}'.replace('/0/', '/' + orderId + '/'),
            type: 'POST',
            data: {
                'csrfmiddlewaretoken': '{{ csrf_token }}'
            },
            success: function(response) {
                if (response.success) {
                    $('#order-' + orderId).remove();
                    alert(response.message);
                } else {
                    alert(response.message);
                }
            },
            error: function() {
                alert('An error occurred. Please try again.');
            }
        });
    }
}
</script>

{% endblock %}
